# Next Stage Plan (2026-02-24)

## 목표
현재 PoC를 "운영 전환 가능 베타"로 끌어올린다.

## Stage 7 범위
1. 인증 고도화
- 헤더 기반 RBAC -> 토큰/JWT 검증 계층 추가

2. 영속 저장소 전환
- in-memory -> SQLite/PostgreSQL 어댑터
- `tasks`, `task_events`, `approval_queue`, `approval_actions` 저장

3. QA/게이트 고정
- CI에서 문서 감사 + 스펙 테스트 + 단계 게이트 강제

4. 모델 라우팅 스켈레톤
- local/api LLM 등록 구조와 라우팅 정책 파일 추가

## 완료 기준
- 서비스 재시작 후 Task/로그/승인 데이터 유지
- RBAC가 인증 토큰 정보 기반으로 작동
- PR마다 자동 품질 게이트 통과 필수
- 모델 라우팅 정책 파일 기준으로 provider 선택 로그 기록

## 실행 순서
1. CI 파이프라인 추가 (즉시)
2. 모델 라우팅 설정 파일/로더 추가 (즉시)
3. 저장소 어댑터 인터페이스 분리 (다음)
4. DB 구현 및 마이그레이션 (다음)
5. JWT 인증 계층 연결 (다음)

## 리스크
- 네트워크 제약 환경에서 런타임 테스트 일부 skip 가능
- DB 전환 시 기존 API 응답 포맷 회귀 위험

## 대응
- 계약 테스트 유지/강화
- 상태 전이 테스트를 DB/메모리 공용으로 실행
- 자동 배치(`run_auto_cycle`)로 회귀 감시
